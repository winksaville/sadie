# A circleci matrix file for the platforms
env:
  #- Platform=VersatilePB
  - Platform=Posix

command:
  # VersatilePB: Create the build directory and the build.ninja file
  - if [[ "${Platform}" == "VersatilePB" ]]; then rm -rf build-${Platform}; mkdir build-${Platform}; fi
  - if [[ "${Platform}" == "VersatilePB" ]]; then cd build-${Platform}; meson -D Platform=${Platform} --cross-file ../cross-file-${Platform} --buildtype plain ..; fi

  # Posix: Create the build directory and the build.ninja file
  - if [[ "${Platform}" == 'Posix' ]]; then rm -rf build-${Platform}; mkdir -p build-${Platform}; fi
  - if [[ "${Platform}" == 'Posix' ]]; then cd build-${Platform}; meson -D Platform=${Platform} ..; fi

  # Run the tests from the current build directory
  - cd build-${Platform}; ninja
  - cd build-${Platform}; ninja run-test-ac_putchar
  - cd build-${Platform}; ninja run-test-ac_string
  - cd build-${Platform}; ninja run-test-ac_arg
  - cd build-${Platform}; ninja run-test-ac_printf
  - cd build-${Platform}; ninja run-test-ac_assert
  - cd build-${Platform}; ninja run-test-ac_dispatcher

